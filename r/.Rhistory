View(urine_pos_sel_data_arrange)
View(urine_plsda_selvar_pos)
#plot
boxplot_intervention_save <- function(feature=...){
feature1 <- feature
data1<- urine_plsda_selvar_pos %>% filter(feature==feature1)
rt<-as.character(round(data1$rt[1],digits = 2))
mz<-data1$mz[1]
pos<-data1$polarity[1]
urine_plsda_selvar_pos %>% filter(feature==feature1) %>% ggplot(aes(x=intervention,y=intensity)) +
geom_point() +
geom_boxplot() +
ggtitle(paste('rt=',rt,'  ','mz=',mz,' ','feature=',feature1,'polarity=',pos))
ggsave(paste0(feature1,'.jpg'))
}
featureX <- paste0('X',1:72)
figure <- lapply(featureX,boxplot_intervention_save)
urine_plsda_selvar_pos <- test %>% select(-mz.y,-feature) %>% mutate (feature=feature_new, mz=mz.x) %>% select(-feature_new, -mz.x)
.libPaths()
.libPaths()
help(.libPaths)
.rProfile
file.path(Sys.getenv("R_USER"), "R")
file.path(Sys.getenv("R_USER"))
file.path(Sys.getenv("R_USER"), "R")
urine_plsda_selvar_pos <- test %>% select(-mz.y,-feature) %>% mutate (feature=feature_new, mz=mz.x) %>% select(-feature_new, -mz.x)
#plot
boxplot_intervention_save <- function(feature=...){
feature1 <- feature
data1<- urine_plsda_selvar_pos %>% filter(feature==feature1)
rt<-as.character(round(data1$rt[1],digits = 2))
mz<-data1$mz[1]
pos<-data1$polarity[1]
urine_plsda_selvar_pos %>% filter(feature==feature1) %>% ggplot(aes(x=intervention,y=intensity)) +
geom_point() +
geom_boxplot() +
ggtitle(paste('rt=',rt,'  ','mz=',mz,' ','feature=',feature1,'polarity=',pos))
ggsave(paste0(feature1,'.jpg'))
}
featureX <- paste0('X',1)
figure <- lapply(featureX,boxplot_intervention_save)
class(data1$mz[1])
data1<- urine_plsda_selvar_pos %>% filter(feature==feature1)
rt<-as.character(round(data1$rt[1],digits = 2))
mz<-data1$mz[1]
data1<- urine_plsda_selvar_pos %>% filter(feature==feature1)
feature1 <- feature
feature1 <- 'X1'
data1<- urine_plsda_selvar_pos %>% filter(feature==feature1)
rt<-as.character(round(data1$rt[1],digits = 2))
mz<-data1$mz[1]
class(mz)
mz<-round(data1$mz[1],digits = 4)
#plot
boxplot_intervention_save <- function(feature=...){
feature1 <- feature
data1<- urine_plsda_selvar_pos %>% filter(feature==feature1)
rt<-as.character(round(data1$rt[1],digits = 2))
mz<-round(data1$mz[1],digits = 4)
pos<-data1$polarity[1]
urine_plsda_selvar_pos %>% filter(feature==feature1) %>% ggplot(aes(x=intervention,y=intensity)) +
geom_point() +
geom_boxplot() +
ggtitle(paste('rt=',rt,'  ','mz=',mz,' ','feature=',feature1,'polarity=',pos))
ggsave(paste0(feature1,'.jpg'))
}
featureX <- paste0('X',1)
figure <- lapply(featureX,boxplot_intervention_save)
#plot
boxplot_intervention_save <- function(feature=...){
feature1 <- feature
data1<- urine_plsda_selvar_pos %>% filter(feature==feature1)
rt<-as.character(round(data1$rt[1],digits = 2))
mz<-round(data1$mz[1],digits = 4)
pos<-data1$polarity[1]
urine_plsda_selvar_pos %>% filter(feature==feature1) %>% ggplot(aes(x=intervention,y=intensity)) +
geom_point() +
geom_boxplot() +
ggtitle(paste('rt=',rt,'  ','mz=',mz,' ','feature=',feature1,' ','polarity=',pos))
ggsave(paste0(feature1,'.jpg'))
}
featureX <- paste0('X',1)
figure <- lapply(featureX,boxplot_intervention_save)
featureX <- paste0('X',1:72)
figure <- lapply(featureX,boxplot_intervention_save)
nrow(mzrt_sel)
#extract neg data
path <- 'c://Users/tuhu/projects/barley/urine_neg_varsel.mat'
polarity <- 'neg'
urine_neg_sel <- m2r(path,polarity)
m2r <- function(path=...,polarity=...){
matdata <- readMat(path)
matdata1 <- matdata[[1]] #[1] and [[1]] are different
#subject info
##extract filename
filename1 <- matdata1$label[[1]]
filename <- filename1[[1]]
##extract samplename
samplename1 <- matdata1$label[[5]]
samplename <- samplename1[[1]]
##extract subjectnumber
subject1 <- matdata1$label[[13]]
subject <- subject1[[1]]
##extract timepoint
timepoint1 <- matdata1$label[[17]]
timepoint <- timepoint1[[1]]
##extract intervention
intervention1 <- matdata1$label[[21]]
intervention <- intervention1[[1]]
##extract rt
rt1 <- matdata1$axisscale[[6]]
rt <- rt1[[1]]
##extract mz
mz1 <- matdata1$label[[2]]
mz <- mz1[[1]]
##extract groupinfo
#group1 <- matdata1$label[[10]]
#group <- group1[[1]]
##extract intensities
int <- matdata1$data
##shape new data
data <- data.frame(filename,samplename,subject,timepoint,intervention)
pools <- data %>% filter(samplename =='pool  ')
nonpools <- data %>% filter(samplename != 'pool  ')
pools$subject <- 'pool'
pools$timepoint <- NA
pools$intervention <- 'pool'
data <- bind_rows(nonpools,pools)
intdata <- data.frame(int)
datan <- bind_cols(data,intdata)
datan1 <- datan %>% gather(feature,intensity,6:ncol(datan))
##write rt and mz
rtdata <- rt %>% data.frame() %>% gather(feature, rt, 1: ncol(rt))
mzdata <- t(mz) %>% data.frame() %>% gather(feature, mz, 1: nrow(mz))
datan2 <- left_join(datan1,rtdata,by='feature') %>% left_join(mzdata,by='feature') %>% mutate(polarity)
return(datan2)}
urine_neg_sel <- m2r(path,polarity)
View(urine_neg_sel)
View(urine_neg_sel)
urine_neg_sel %>% group_by(feature)
featurex <- paste('X',1:86,sep='')
figure <- lapply(featurex,boxplot_intervention)
boxplot_intervention <- function(feature=...){
feature1 <- feature
data1<- urine_neg_sel %>% filter(feature==feature1)
rt<-as.character(round(data1$rt[1],digits = 2))
mz<-data1$mz[1]
fig <- urine_neg_sel %>% filter(feature==feature1) %>% ggplot(aes(x=intervention,y=intensity)) +
geom_point() +
geom_boxplot() +
ggtitle(paste('rt=',rt,'  ','mz=',mz,' ','feature=',feature1))
return(fig)
}
featurex <- paste('X',1:86,sep='')
figure <- lapply(featurex,boxplot_intervention)
urine_neg_sel %>% group_by(feature) %>% summarize(mean(intensity))
urine_neg_sel %>% group_by(feature,intervention) %>% summarize(mean(intensity))
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>% group_by(feature,intervention) %>%
summarize(mean(intensity)) %>%
#PLOT NEG DATA
boxplot_intervention <- function(feature=...){
feature1 <- feature
data1<- urine_neg_sel %>% filter(feature==feature1)
rt<-as.character(round(data1$rt[1],digits = 2))
mz<-data1$mz[1]
fig <- urine_neg_sel %>% filter(feature==feature1) %>% ggplot(aes(x=intervention,y=intensity)) +
geom_point() +
geom_boxplot() +
ggtitle(paste('rt=',rt,'  ','mz=',mz,' ','feature=',feature1))
return(fig)
}
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>% group_by(feature,intervention) %>%
summarize(mean(intensity))
View(summary_neg)
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>% group_by(feature,intervention) %>% filter(-intervention=c('pool','BB   ','BW  ')) %>%
summarize(mean(intensity))
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>% group_by(feature,intervention) %>% filter(-intervention=c('pool','BB   ','BW  '))
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>% group_by(feature,intervention) %>% filter(-intervention==c('pool','BB   ','BW  '))
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>% group_by(feature,intervention) %>% filter(intervention!=c('pool','BB   ','BW  '))
warning()
warnings()
warnings(1)
warnings(2)
View(summary_neg)
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>% group_by(feature,intervention) %>% filter(intervention=c('AB   ','AW  '))
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>% group_by(feature,intervention) %>% filter(intervention==c('AB   ','AW  '))
View(summary_neg)
urine_neg_sel$intensity
urine_neg_sel$intervention
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>% group_by(feature,intervention) %>% filter(intervention%in%c('AB   ','AW  '))
View(summary_neg)
c('AB   ','AW  ')
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB   ','AW  '))
View(summary_neg)
unique(urine_neg_sel$intervention)
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB ','AW  '))
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB ','AW  '))
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB ','AW  '))
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB  ','AW  '))
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB  ','AW  '))%>%
summarize(mean(intensity))
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB  ','AW  '))%>%
summarize(mean(intensity))
View(summary_neg)
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB  ','AW  '))%>% group_by('intervention')
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB  ','AW  '))%>% group_by('intervention') %>%
summarize(mean(intensity))
View(summary_neg)
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB  ','AW  ')) %>% group_by(intervention,feature) %>%
summarize(mean(intensity))
View(summary_neg)
summary_neg1 <- urine_neg_sel  %>% filter(intervention %in% c('AB  ','AW  ')) %>% filter(feature='X1')
summary_neg1 <- urine_neg_sel  %>%
filter(intervention %in% c('AB  ','AW  ')) %>%
filter(feature=='X1')
View(summary_neg1)
summary_neg1 <- urine_neg_sel  %>%
filter(intervention %in% c('AB  ','AW  ')) %>%
filter(feature=='X1') %>% spread(intervention,intensity)
summary_neg1 <- urine_neg_sel  %>%
filter(intervention %in% c('AB  ','AW  ')) %>%
filter(feature=='X1') %>% spread(intervention,intensity) %>% group_by(subject) %>% bind_rows()
summary_neg1 <- urine_neg_sel  %>%
filter(intervention %in% c('AB  ','AW  ')) %>%
filter(feature=='X1') %>% spread(intervention,intensity) %>% group_by(subject) %>% select(subject,AB,AW)
summary_neg1 <- urine_neg_sel  %>%
filter(intervention %in% c('AB  ','AW  ')) %>%
filter(feature=='X1') %>% spread(intervention,intensity) %>% group_by(subject) %>% select(subject,'AB  ','AW  ')
summary_neg1_AB <- summary_neg1 %>% select(subject,'AB  ') %>% mutate(AB='AB  ')
View(summary_neg1_AB)
summary_neg1_AB <- summary_neg1 %>% select(subject,'AB  ')
summary_neg1_AW <- summary_neg1 %>% select(subject,'AW  ')
View(summary_neg1_AB)
View(summary_neg1_AW)
summary_neg1_AB <- summary_neg1 %>% select(subject,'AB  ') %>% filter(AB=!is.na())
summary_neg1_AB <- summary_neg1 %>% select(subject,'AB  ') %>% filter(AB==!is.na())
summary_neg1_AB <- summary_neg1 %>% select(subject,'AB  ') %>% filter('AB  '==!is.na())
summary_neg1_AB <- summary_neg1 %>% select(subject,'AB  ')
summary(summary_neg1_AB)
#extract neg data
path <- 'c://Users/tuhu/projects/barley/urine_neg_varsel.mat'
polarity <- 'neg'
#convert mat into R dataset
m2r <- function(path=...,polarity=...){
matdata <- readMat(path)
matdata1 <- matdata[[1]] #[1] and [[1]] are different
#subject info
##extract filename
filename1 <- matdata1$label[[1]]
filename <- filename1[[1]]
##extract samplename
samplename1 <- matdata1$label[[5]]
samplename <- samplename1[[1]]
##extract subjectnumber
subject1 <- matdata1$label[[13]]
subject <- subject1[[1]]
##extract timepoint
timepoint1 <- matdata1$label[[17]]
timepoint <- timepoint1[[1]]
##extract intervention
intervention1 <- matdata1$label[[21]]
intervention <- intervention1[[1]]
##extract rt
rt1 <- matdata1$axisscale[[6]]
rt <- rt1[[1]]
##extract mz
mz1 <- matdata1$label[[2]]
mz <- mz1[[1]]
##extract groupinfo
#group1 <- matdata1$label[[10]]
#group <- group1[[1]]
##extract intensities
int <- matdata1$data
##shape new data
data <- data.frame(filename,samplename,subject,timepoint,intervention)
pools <- data %>% filter(samplename =='pool  ')
nonpools <- data %>% filter(samplename != 'pool  ')
pools$subject <- 'pool'
pools$timepoint <- NA
pools$intervention <- 'pool'
data <- bind_rows(nonpools,pools)
intdata <- data.frame(int)
datan <- bind_cols(data,intdata)
datan1 <- datan %>% gather(feature,intensity,6:ncol(datan))
##write rt and mz
rtdata <- rt %>% data.frame() %>% gather(feature, rt, 1: ncol(rt))
mzdata <- t(mz) %>% data.frame() %>% gather(feature, mz, 1: nrow(mz))
datan2 <- left_join(datan1,rtdata,by='feature') %>% left_join(mzdata,by='feature') %>% mutate(polarity)
return(datan2)}
matdata <- readMat(path)
matdata1 <- matdata[[1]] #[1] and [[1]] are different
#subject info
##extract filename
filename1 <- matdata1$label[[1]]
filename <- filename1[[1]]
##extract samplename
samplename1 <- matdata1$label[[5]]
samplename <- samplename1[[1]]
##extract subjectnumber
subject1 <- matdata1$label[[13]]
subject <- subject1[[1]]
##extract timepoint
timepoint1 <- matdata1$label[[17]]
timepoint <- timepoint1[[1]]
##extract intervention
intervention1 <- matdata1$label[[21]]
intervention <- intervention1[[1]]
##extract rt
rt1 <- matdata1$axisscale[[6]]
rt <- rt1[[1]]
##extract mz
mz1 <- matdata1$label[[2]]
mz <- mz1[[1]]
##extract groupinfo
#group1 <- matdata1$label[[10]]
#group <- group1[[1]]
##extract intensities
int <- matdata1$data
data <- data.frame(filename,samplename,subject,timepoint,intervention)
pools <- data %>% filter(samplename =='pool  ')
nonpools <- data %>% filter(samplename != 'pool  ')
pools$subject <- 'pool'
pools$timepoint <- NA
pools$intervention <- 'pool'
data <- bind_rows(nonpools,pools)
intdata <- data.frame(int)
datan <- bind_cols(data,intdata)
datan1 <- datan %>% gather(feature,intensity,6:ncol(datan))
##write rt and mz
rtdata <- rt %>% data.frame() %>% gather(feature, rt, 1: ncol(rt))
mzdata <- t(mz) %>% data.frame() %>% gather(feature, mz, 1: nrow(mz))
datan2 <- left_join(datan1,rtdata,by='feature') %>% left_join(mzdata,by='feature') %>% mutate(polarity)
View(datan2)
#character tweaking
datan2$intervention
#character tweaking
datan2$intervention %>% str_replace_all(space(), "")
?space
??space
library(stringr)
#character tweaking
datan2$intervention %>% str_replace_all(space(), "")
#character tweaking
datan2$intervention %>% str_replace_all(' ',"")
return(datan2)}
m2r <- function(path=...,polarity=...){
matdata <- readMat(path)
matdata1 <- matdata[[1]] #[1] and [[1]] are different
#subject info
##extract filename
filename1 <- matdata1$label[[1]]
filename <- filename1[[1]]
##extract samplename
samplename1 <- matdata1$label[[5]]
samplename <- samplename1[[1]]
##extract subjectnumber
subject1 <- matdata1$label[[13]]
subject <- subject1[[1]]
##extract timepoint
timepoint1 <- matdata1$label[[17]]
timepoint <- timepoint1[[1]]
##extract intervention
intervention1 <- matdata1$label[[21]]
intervention <- intervention1[[1]]
##extract rt
rt1 <- matdata1$axisscale[[6]]
rt <- rt1[[1]]
##extract mz
mz1 <- matdata1$label[[2]]
mz <- mz1[[1]]
##extract groupinfo
#group1 <- matdata1$label[[10]]
#group <- group1[[1]]
##extract intensities
int <- matdata1$data
##shape new data
data <- data.frame(filename,samplename,subject,timepoint,intervention)
pools <- data %>% filter(samplename =='pool  ')
nonpools <- data %>% filter(samplename != 'pool  ')
pools$subject <- 'pool'
pools$timepoint <- NA
pools$intervention <- 'pool'
data <- bind_rows(nonpools,pools)
intdata <- data.frame(int)
datan <- bind_cols(data,intdata)
datan1 <- datan %>% gather(feature,intensity,6:ncol(datan))
##write rt and mz
rtdata <- rt %>% data.frame() %>% gather(feature, rt, 1: ncol(rt))
mzdata <- t(mz) %>% data.frame() %>% gather(feature, mz, 1: nrow(mz))
datan2 <- left_join(datan1,rtdata,by='feature') %>% left_join(mzdata,by='feature') %>% mutate(polarity)
#character tweaking
intervention_new <- datan2$intervention %>% str_replace_all(' ',"")
datan2 <- datan2 %>% mutate(intervention_new)
return(datan2)}
urine_neg_sel <- m2r(path,polarity)
View(urine_neg_sel)
return(datan2)}
path <- 'c://Users/tuhu/projects/barley/urine_neg_varsel.mat'
polarity <- 'neg'
#convert mat into R dataset
m2r <- function(path=...,polarity=...){
matdata <- readMat(path)
matdata1 <- matdata[[1]] #[1] and [[1]] are different
#subject info
##extract filename
filename1 <- matdata1$label[[1]]
filename <- filename1[[1]]
##extract samplename
samplename1 <- matdata1$label[[5]]
samplename <- samplename1[[1]]
##extract subjectnumber
subject1 <- matdata1$label[[13]]
subject <- subject1[[1]]
##extract timepoint
timepoint1 <- matdata1$label[[17]]
timepoint <- timepoint1[[1]]
##extract intervention
intervention1 <- matdata1$label[[21]]
intervention <- intervention1[[1]]
##extract rt
rt1 <- matdata1$axisscale[[6]]
rt <- rt1[[1]]
##extract mz
mz1 <- matdata1$label[[2]]
mz <- mz1[[1]]
##extract groupinfo
#group1 <- matdata1$label[[10]]
#group <- group1[[1]]
##extract intensities
int <- matdata1$data
##shape new data
data <- data.frame(filename,samplename,subject,timepoint,intervention)
pools <- data %>% filter(samplename =='pool  ')
nonpools <- data %>% filter(samplename != 'pool  ')
pools$subject <- 'pool'
pools$timepoint <- NA
pools$intervention <- 'pool'
data <- bind_rows(nonpools,pools)
intdata <- data.frame(int)
datan <- bind_cols(data,intdata)
datan1 <- datan %>% gather(feature,intensity,6:ncol(datan))
##write rt and mz
rtdata <- rt %>% data.frame() %>% gather(feature, rt, 1: ncol(rt))
mzdata <- t(mz) %>% data.frame() %>% gather(feature, mz, 1: nrow(mz))
datan2 <- left_join(datan1,rtdata,by='feature') %>% left_join(mzdata,by='feature') %>% mutate(polarity)
#character tweaking
intervention_new <- datan2$intervention %>% str_replace_all(' ',"")
datan2 <- datan2 %>% select(-intervention) %>% mutate(intervention=intervention_new)
return(datan2)}
urine_neg_sel <- m2r(path,polarity)
#OUTPUT FOR IDENTIFICATION
summary_neg <- urine_neg_sel %>%
filter(intervention %in% c('AB','AW')) %>% group_by(intervention,feature) %>%
summarize(mean(intensity))
View(summary_neg)
summary_neg1 <- urine_neg_sel  %>%
filter(intervention %in% c('AB  ','AW  ')) %>%
filter(feature=='X1') %>% spread(intervention,intensity) %>% group_by(subject) %>% select(subject,'AB','AW')
summary_neg1 <- urine_neg_sel  %>%
filter(intervention %in% c('AB','AW')) %>%
filter(feature=='X1') %>% spread(intervention,intensity) %>% group_by(subject) %>% select(subject,'AB','AW')
View(summary_neg1)
summary_neg1_AB <- summary_neg1 %>% select(subject,'AB')
summary_neg1_AW <- summary_neg1 %>% select(subject,'AW')
View(summary_neg1_AB)
View(summary_neg1_AW)
summary_neg1_AB <- summary_neg1 %>% select(subject,AB) %>% drop_na(AB)
summary_neg1_AW <- summary_neg1 %>% select(subject,AW) %>% drop_na(AW)
full_join(summary_neg1_AB,summary_neg1_AW,by=subject)
subject <- summary_neg1_AB$subject
full_join(summary_neg1_AB,summary_neg1_AW,by=subject)
full_join(summary_neg1_AB, summary_neg1_AW)
summary_neg1_full
summary_neg1_full <- full_join(summary_neg1_AB, summary_neg1_AW)
summary_neg1_full %>% ggplot(aes(x=AB,y=AW)) + geom_point()
summary_neg1 <- urine_neg_sel  %>%
filter(intervention %in% c('AB','AW')) %>%
filter(feature=='X2') %>% spread(intervention,intensity) %>% group_by(subject) %>% select(subject,'AB','AW')
summary_neg1_AB <- summary_neg1 %>% select(subject,AB) %>% drop_na(AB)
summary_neg1_AW <- summary_neg1 %>% select(subject,AW) %>% drop_na(AW)
subject <- summary_neg1_AB$subject
summary_neg1_full <- full_join(summary_neg1_AB, summary_neg1_AW)
summary_neg1_full %>% ggplot(aes(x=AB,y=AW)) + geom_point()
